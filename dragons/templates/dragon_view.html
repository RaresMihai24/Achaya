{% extends "base.html" %}   {# or whatever your site‐wide base is #}


{# show user's dragons #}
<div class="my-dragons">
    <h2>Your Dragons</h2>
    {% if dragons %}
      <ul>
        {% for dragon in dragons %}
          <li><a href="{% url 'index' %}?name={{ dragon.name }}">{{ dragon.name }}</a></li>
        {% endfor %}
      </ul>
    {% else %}
      <p>You don’t own any dragons yet!</p>
    {% endif %}
</div>

{% if selected_dragon %}

<div class="dragon-display">

    <div class="dragon-name-wrapper">
		<h3 class="dragon-name">{{ selected_dragon.name }}</h3>
		<img src="{% static 'images/buttons/rename_button.png' %}" class="rename-icon" alt="Rename" onclick="openRenameOverlay()">
	</div>

    <form method="POST" action="{% url 'rename_dragon' %}" class="rename-form" id="renameForm" style="display: none;">
        {% csrf_token %}
        <input type="hidden" name="dragon_id" value="{{ selected_dragon.id }}">
        <input type="text" name="new_name" value="{{ selected_dragon.name }}" class="rename-input">
    </form>

    <img src="{% static 'images/dragon-placeholder.jpg' %}" alt="Dragon" class="dragon-model">
</div>
<div class="dragon-layout-wrapper">
<div class="dragon-section">
    <div class="action-panel">
        <h3>Actions</h3>
        <div class="action-buttons">
<div class="action-buttons-grid">
    <form method="POST" action="{% url 'action_dragon' 'feed' %}">
        {% csrf_token %}
        <input type="hidden" name="dragon_name" value="{{ selected_dragon.name }}">
        <button type="submit">Feed</button>
    </form>
    <form method="POST" action="{% url 'action_dragon' 'water' %}">
        {% csrf_token %}
        <input type="hidden" name="dragon_name" value="{{ selected_dragon.name }}">
        <button type="submit">Give Water</button>
    </form>
    <form method="POST" action="{% url 'action_dragon' 'play' %}">
        {% csrf_token %}
        <input type="hidden" name="dragon_name" value="{{ selected_dragon.name }}">
        <button type="submit">Play</button>
    </form>
    <form method="POST" action="{% url 'action_dragon' 'groom' %}">
        {% csrf_token %}
        <input type="hidden" name="dragon_name" value="{{ selected_dragon.name }}">
        <button type="submit">Groom</button>
    </form>
    <form method="POST" action="{% url 'action_dragon' 'treat' %}">
        {% csrf_token %}
        <input type="hidden" name="dragon_name" value="{{ selected_dragon.name }}">
        <button type="submit">Give Treat</button>
    </form>
    <form method="POST" action="{% url 'action_dragon' 'sleep' %}">
        {% csrf_token %}
        <input type="hidden" name="dragon_name" value="{{ selected_dragon.name }}">
        <button type="submit">Send to Sleep</button>
    </form>
</div>
        </div>
    </div>

    <div class="dragon-card">
        <div class="dragon-info">
            <!-- Energy stat bar -->
            <div class="stat-bar">
                <div class="stat-label">
                    <label>Energy</label>
                </div>
                <div class="bar-container">
                    <div class="bar">
                        <div class="bar-fill energy-fill">
                            <div class="bar-mask" style="width: {{ selected_dragon.energy_mask }}%;"></div>
                        </div>
                    </div>
                    <div class="stat-percentage">
                        {{ selected_dragon.energy }}%
                    </div>
                </div>
            </div>
            
            <!-- Moral stat bar -->
            <div class="stat-bar">
                <div class="stat-label">
                    <label>Moral</label>
                </div>
                <div class="bar-container">
                    <div class="bar">
                        <div class="bar-fill moral-fill">
                            <div class="bar-mask" style="width: {{ selected_dragon.moral_mask }}%;"></div>
                        </div>
                    </div>
                    <div class="stat-percentage">
                        {{ selected_dragon.moral }}%
                    </div>
                </div>
            </div>
            
            <!-- Health stat bar -->
            <div class="stat-bar">
                <div class="stat-label">
                    <label>Health</label>
                </div>
                <div class="bar-container">
                    <div class="bar">
                        <div class="bar-fill health-fill">
                            <div class="bar-mask" style="width: {{ selected_dragon.health_mask }}%;"></div>
                        </div>
                    </div>
                    <div class="stat-percentage">
                        {{ selected_dragon.health }}%
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
    <div class="statistics">
        <div class="total-stat-wrapper">
            <label>Total:</label>
            <div class="stat-value">
                {{ total_points|floatformat:2 }}
            </div>
        </div>

        <h3>Ability Points</h3>

        <!-- Attack Stat -->
        <div class="stat-row">
            <label>Attack:</label>
            <div class="stars">
                {% with star_dict=ac_res_stars %}
                    {% for star in star_dict|get_item:"blue" %}
                        <span>&#9733;</span>
                    {% endfor %}
                    {% for star in star_dict|get_item:"green" %}
                        <span style="color: yellow;">&#9733;</span>
                    {% endfor %}
                    {% if star_dict|get_item:"half" %}
                        <span style="color: yellow;">&#9734;</span>
                    {% endif %}
                    {% for i in star_dict|get_item:"empty" %}
                        &#9734;
                    {% endfor %}
                {% endwith %}
            </div>
            <div class="stat-value">{{ selected_dragon.ac_res|floatformat:2 }}</div>
        </div>

        <!-- Defense Stat -->
        <div class="stat-row">
            <label>Defence:</label>
            <div class="stars">
                {% with star_dict=ac_vit_stars %}
                    {% for star in star_dict|get_item:"blue" %}
                        <span>&#9733;</span>
                    {% endfor %}
                    {% for star in star_dict|get_item:"green" %}
                        <span style="color: yellow;">&#9733;</span>
                    {% endfor %}
                    {% if star_dict|get_item:"half" %}
                        <span style="color: yellow;">&#9734;</span>
                    {% endif %}
                    {% for i in star_dict|get_item:"empty" %}
                        &#9734;
                    {% endfor %}
                {% endwith %}
            </div>
            <div class="stat-value">{{ selected_dragon.ac_vit|floatformat:2 }}</div>
        </div>

        <!-- Speed Stat -->
        <div class="stat-row">
            <label>Speed:</label>
            <div class="stars">
                {% with star_dict=ac_dre_stars %}
                    {% for star in star_dict|get_item:"blue" %}
                        <span style="color: red;">&#9733;</span>
                    {% endfor %}
                    {% for star in star_dict|get_item:"green" %}
                        <span style="color: yellow;">&#9733;</span>
                    {% endfor %}
                    {% if star_dict|get_item:"half" %}
                        <span style="color: yellow;">&#9734;</span>
                    {% endif %}
                    {% for i in star_dict|get_item:"empty" %}
                        &#9734;
                    {% endfor %}
                {% endwith %}
            </div>
            <div class="stat-value">{{ selected_dragon.ac_dre|floatformat:2 }}</div>
        </div>

        <!-- Magic Stat -->
        <div class="stat-row">
            <label>Magic:</label>
            <div class="stars">
                {% with star_dict=ac_gal_stars %}
                    {% for star in star_dict|get_item:"blue" %}
                        <span>&#9733;</span>
                    {% endfor %}
                    {% for star in star_dict|get_item:"green" %}
                        <span style="color: yellow;">&#9733;</span>
                    {% endfor %}
                    {% if star_dict|get_item:"half" %}
                        <span style="color: yellow;">&#9734;</span>
                    {% endif %}
                    {% for i in star_dict|get_item:"empty" %}
                        &#9734;
                    {% endfor %}
                {% endwith %}
            </div>
            <div class="stat-value">{{ selected_dragon.ac_gal|floatformat:2 }}</div>
        </div>

        <!-- Intuity Stat -->
        <div class="stat-row">
            <label>Intuity:</label>
            <div class="stars">
                {% with star_dict=ac_tra_stars %}
                    {% for star in star_dict|get_item:"blue" %}
                        <span>&#9733;</span>
                    {% endfor %}
                    {% for star in star_dict|get_item:"green" %}
                        <span style="color: yellow;">&#9733;</span>
                    {% endfor %}
                    {% if star_dict|get_item:"half" %}
                        <span style="color: yellow;">&#9734;</span>
                    {% endif %}
                    {% for i in star_dict|get_item:"empty" %}
                        &#9734;
                    {% endfor %}
                {% endwith %}
            </div>
            <div class="stat-value">{{ selected_dragon.ac_tra|floatformat:2 }}</div>
        </div>

        <!-- Harmony Stat -->
        <div class="stat-row">
            <label>Harmony:</label>
            <div class="stars">
                {% with star_dict=ac_sar_stars %}
                    {% for star in star_dict|get_item:"blue" %}
                        <span>&#9733;</span>
                    {% endfor %}
                    {% for star in star_dict|get_item:"green" %}
                        <span style="color: yellow;">&#9733;</span>
                    {% endfor %}
                    {% if star_dict|get_item:"half" %}
                        <span style="color: yellow;">&#9734;</span>
                    {% endif %}
                    {% for i in star_dict|get_item:"empty" %}
                        &#9734;
                    {% endfor %}
                {% endwith %}
            </div>
            <div class="stat-value">{{ selected_dragon.ac_sar|floatformat:2 }}</div>
        </div>
    </div>

    <!-- Tabs for Characteristics, Genetic, Bonus -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab" onclick="showTab('characteristics')">Characteristics</button>
            <button class="tab" onclick="showTab('genetic')">Genetic</button>
            <button class="tab" onclick="showTab('bonus')">Bonus</button>
        </div>
<div id="characteristics" class="tab-content">
    <div class="characteristics-container">
        <div class="column">
            <p><strong>Specie:</strong> {{ specie }}</p>
            <p><strong>Race:</strong> {{ race }}</p>
            <p><strong>Sex:</strong> {{ sex }}</p>
            <p><strong>Pattern:</strong> Undefined</p>
            <p><strong>Bred By:</strong> {{ selected_dragon.producer }}</p>
        </div>
        <div class="column">
            <p><strong>Age:</strong> {{ age }}</p>
            <p><strong>Height:</strong> {{ height }} cms</p>
            <p><strong>Weight:</strong> {{ weight }} kg</p>
            <p><strong>Born On:</strong> {{ born_on }}</p>
        </div>
    </div>
</div>
        <div id="genetic" class="tab-content" style="display:none;">
            <p><strong style="color: #cc0000;">Genetic Potential:</strong> {{ GP }}</p>
            <div class="characteristics-container">
                <div class="column">
                    <div class="genetic-stat"><strong>Attack:</strong> {{ res }}</div>
                    <div class="genetic-stat"><strong>Defence:</strong> {{ vit }}</div>
                    <div class="genetic-stat"><strong>Speed:</strong> {{ dre }}</div>
                </div>
                <div class="column">
                    <div class="genetic-stat"><strong>Magic:</strong> {{ gal }}</div>
                    <div class="genetic-stat"><strong>Intuity:</strong> {{ sar }}</div>
                    <div class="genetic-stat"><strong>Harmony:</strong> {{ tra }}</div>
                </div>
            </div>
            <hr>
            <div class="blup-container">
                <h4 style="margin-top: 30px;">BLUP</h4>
                <div class="blup-meter-wrapper">
                    <div class="blup-meter-track">
                        <div class="blup-meter-fill" style="left: calc(50% + {{ BLUP }}% - 5px);"></div>
                    </div>
                    <div class="blup-meter-labels">
                        <span>-100</span>
                        <span>0</span>
                        <span>100</span>
                    </div>
                </div>
                <p style="text-align: center; margin-top: 5px;">
                    Current BLUP: <strong>{{ BLUP }}</strong>
                </p>
            </div>
            <hr>
            <div class="origin-container">
                <h4>Origin</h4>
                <p><strong>Dragonesse:</strong>
                    <a href="{% url 'index' %}?name={{ mother }}">
    {{ mother }}
</a>
                </p>
                <p><strong>Dragon:</strong>
                    <a href="{% url 'index' %}?name={{ father }}">
    {{ father }}
</a>
                </p>
            </div>
            <hr>
            <div class="genetic-stars-container">
                <h4>Genetic Potential</h4>
                <div class="star-grid">
                    {% for label, value in traits.items %}
                        {% if value >= 100 %}
                            <div class="stat-row">
                                <label>{{ label }}:</label>
                                <div class="stars">
                                    {% with star_dict=traits_stars|get_item:label %}
                                        {% for star in star_dict|get_item:"blue" %}
                                            <span style="color: red;">&#9733;</span>
                                        {% endfor %}
                                        {% for star in star_dict|get_item:"green" %}
                                            <span style="color: yellow;">&#9733;</span>
                                        {% endfor %}
                                        {% if star_dict|get_item:"half" %}
                                            <span style="color: yellow;">&#9734;</span>
                                        {% endif %}
                                        {% for i in star_dict|get_item:"empty" %}
                                            &#9734;
                                        {% endfor %}
                                    {% endwith %}
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            <p style="margin-top: 15px;">
                This dragon has <span style="font-weight: bold;">{{ excellence_stars }}</span> excellence stars.
            </p>
        </div>
        <div id="bonus" class="tab-content" style="display:none;">
            <h4>Bonus</h4>
            <p>Here you can display any bonus or special features the dragon may have.</p>
            <ul>
                <li>Bonus: +20% Health</li>
                <li>Bonus: +15% Attack Power</li>
            </ul>
        </div>
    </div>

    {% endif %}
    <h2>Breed Dragons</h2>
    <form method="POST" action="{% url 'breed_dragon' %}">
        {% csrf_token %}
        <label for="mother">Mother:</label>
        <select name="mother" required>
            <option value="">Select Mother</option>
            {% for dragon in dragons %}
                <option value="{{ dragon.name }}">{{ dragon.name }}</option>
            {% endfor %}
        </select>
        <label for="father">Father:</label>
        <select name="father" required>
            <option value="">Select Father</option>
            {% for dragon in dragons %}
                <option value="{{ dragon.name }}">{{ dragon.name }}</option>
            {% endfor %}
        </select>
        <label for="foal_name">Foal Name:</label>
        <input type="text" name="foal_name" required>
        <button type="submit">Breed</button>
    </form>
<div class="rename-overlay" id="renameOverlay" style="display: none;">
    <div class="rename-modal">
        <form method="POST" action="{% url 'rename_dragon' %}" class="rename-form">
            {% csrf_token %}
            <input type="hidden" name="dragon_id" value="{{ selected_dragon.id }}">
            <input type="text" name="new_name" value="{{ selected_dragon.name }}" class="rename-input" required>
            <button type="submit" class="rename-confirm-btn">Rename</button>
        </form>
    </div>
</div>
</body>
</html>
